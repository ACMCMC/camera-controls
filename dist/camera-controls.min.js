!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CameraControls=e()}(this,function(){"use strict";var t=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._listeners={}}return t.prototype.addEventListener=function(t,e){var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},t.prototype.hasEventListener=function(t,e){var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},t.prototype.removeEventListener=function(t,e){var i=this._listeners[t];if(void 0!==i){var o=i.indexOf(e);-1!==o&&i.splice(o,1)}},t.prototype.dispatchEvent=function(t){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=e.slice(0),o=0,r=i.length;o<r;o++)i[o].call(this,t)}},t}();var E=void 0,b=void 0,A=void 0,x=void 0,m=void 0,r=void 0,a=void 0,w=void 0,M=void 0,g=.001,D=-1,S=0,j=1,C=2,L=3,T=4,z=5;function e(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function s(t){return Math.abs(t)<Number.MAX_VALUE?t:t*(1/0)}return function(y){function f(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,y.call(this));if(o.object=t,o.enabled=!0,o._state=D,o.minDistance=0,o.maxDistance=1/0,o.minZoom=0,o.maxZoom=1/0,o.minPolarAngle=0,o.maxPolarAngle=Math.PI,o.minAzimuthAngle=-1/0,o.maxAzimuthAngle=1/0,o.dampingFactor=.05,o.draggingDampingFactor=.25,o.phiSpeed=1,o.thetaSpeed=1,o.dollySpeed=1,o.truckSpeed=2,o.dollyToCursor=!1,o.verticalDragToForward=!1,o.domElement=e,o._target=new E.Vector3,o._targetEnd=new E.Vector3,o._spherical=(new E.Spherical).setFromVector3(o.object.position),o._sphericalEnd=o._spherical.clone(),o._target0=o._target.clone(),o._position0=o.object.position.clone(),o._zoom0=o.object.zoom,o._dollyControlAmount=0,o._dollyControlCoord=new E.Vector2,o._needsUpdate=!0,o.update(0),!o.domElement||i.ignoreDOMEventListeners)o._removeAllEventListeners=function(){};else{var d=function(t,e){if(e.set(0,0),t.touches){for(var i=0;i<t.touches.length;i++)e.x+=t.touches[i].clientX,e.y+=t.touches[i].clientY;return e.x/=t.touches.length,e.y/=t.touches.length,e}return e.set(t.clientX,t.clientY),e},r=function(t){if(m.enabled){t.preventDefault();var e=m._state;switch(t.button){case E.MOUSE.LEFT:m._state=S;break;case E.MOUSE.MIDDLE:m._state=j;break;case E.MOUSE.RIGHT:m._state=C}e!==m._state&&h(t)}},a=function(t){if(m.enabled){t.preventDefault();var e=m._state;switch(t.touches.length){case 1:m._state=L;break;case 2:m._state=T;break;case 3:m._state=z}e!==m._state&&h(t)}},s=function(t){if(m.enabled){t.preventDefault();var e=0===navigator.platform.indexOf("Mac")?-1:-3,i=void 0;i=void 0!==t.wheelDelta?t.wheelDelta/120:1===t.deltaMode?t.deltaY/e:t.deltaY/(10*e);var o=void 0,r=void 0;m.dollyToCursor&&(v=m.domElement.getBoundingClientRect(),o=(t.clientX-v.left)/v.width*2-1,r=(t.clientY-v.top)/v.height*-2+1),u(-i,o,r)}},n=function(t){m.enabled&&t.preventDefault()},h=function(t){if(m.enabled){if(t.preventDefault(),d(t,b),v=m.domElement.getBoundingClientRect(),g.copy(b),m._state===T){var e=b.x-t.touches[1].pageX,i=b.y-t.touches[1].pageY,o=Math.sqrt(e*e+i*i);_.set(0,o);var r=.5*(t.touches[0].pageX+t.touches[1].pageX),a=.5*(t.touches[0].pageY+t.touches[1].pageY);g.set(r,a)}document.addEventListener("mousemove",c,{passive:!1}),document.addEventListener("touchmove",c,{passive:!1}),document.addEventListener("mouseup",l),document.addEventListener("touchend",l),m.dispatchEvent({type:"controlstart",originalEvent:t})}},c=function(t){if(m.enabled){t.preventDefault(),d(t,b);var e=g.x-b.x,i=g.y-b.y;switch(g.copy(b),m._state){case S:case L:var o=2*Math.PI*m.phiSpeed*e/v.width,r=2*Math.PI*m.thetaSpeed*i/v.height;m.rotate(o,r,!0);break;case j:break;case T:var a=b.x-t.touches[1].pageX,s=b.y-t.touches[1].pageY,n=Math.sqrt(a*a+s*s),h=_.y-n,c=m.dollyToCursor?(g.x-v.left)/v.width*2-1:0,l=m.dollyToCursor?(g.y-v.top)/v.height*-2+1:0;u(h/8,c,l),_.set(0,n),p(e,i);break;case C:case z:p(e,i)}m.dispatchEvent({type:"control",originalEvent:t})}},l=function t(e){m.enabled&&(m._state=D,document.removeEventListener("mousemove",c),document.removeEventListener("touchmove",c),document.removeEventListener("mouseup",t),document.removeEventListener("touchend",t),m.dispatchEvent({type:"controlend",originalEvent:e}))},p=function(t,e){if(m.object.isPerspectiveCamera){var i=A.copy(m.object.position).sub(m._target),o=m.object.fov*E.Math.DEG2RAD,r=i.length()*Math.tan(o/2),a=m.truckSpeed*t*r/v.height,s=m.truckSpeed*e*r/v.height;m.verticalDragToForward?(m.truck(a,0,!0),m.forward(-s,!0)):m.truck(a,s,!0)}else if(m.object.isOrthographicCamera){var n=t*(m.object.right-m.object.left)/m.object.zoom/v.width,h=e*(m.object.top-m.object.bottom)/m.object.zoom/v.height;m.truck(n,h,!0)}},u=function(t,e,i){var o=Math.pow(.95,-t*m.dollySpeed);if(m.object.isPerspectiveCamera){var r=m._sphericalEnd.radius*o-m._sphericalEnd.radius,a=m._sphericalEnd.radius;m.dolly(r),m.dollyToCursor&&(m._dollyControlAmount+=m._sphericalEnd.radius-a,m._dollyControlCoord.set(e,i))}else m.object.isOrthographicCamera&&(m.object.zoom=Math.max(m.minZoom,Math.min(m.maxZoom,m.object.zoom*o)),m.object.updateProjectionMatrix(),m._needsUpdate=!0)},m=o,g=new E.Vector2,_=new E.Vector2,v=void 0;o.domElement.addEventListener("mousedown",r),o.domElement.addEventListener("touchstart",a),o.domElement.addEventListener("wheel",s),o.domElement.addEventListener("contextmenu",n),o._removeAllEventListeners=function(){m.domElement.removeEventListener("mousedown",r),m.domElement.removeEventListener("touchstart",a),m.domElement.removeEventListener("wheel",s),m.domElement.removeEventListener("contextmenu",n),document.removeEventListener("mousemove",c),document.removeEventListener("touchmove",c),document.removeEventListener("mouseup",l),document.removeEventListener("touchend",l)}}return o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(f,y),f.install=function(t){E=t.THREE,b=new E.Vector2,A=new E.Vector3,x=new E.Vector3,m=new E.Vector3,r=new E.Vector3,a=new E.Vector3,w=new E.Spherical,M=new E.Spherical},f.prototype.rotate=function(t,e,i){this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)},f.prototype.rotateTo=function(t,e,i){var o=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,t)),r=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e));this._sphericalEnd.theta=o,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi),this._needsUpdate=!0},f.prototype.dolly=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):this.dollyTo(this._sphericalEnd.radius+t,e)},f.prototype.dollyTo=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):(this._sphericalEnd.radius=E.Math.clamp(t,this.minDistance,this.maxDistance),e||(this._spherical.radius=this._sphericalEnd.radius),this._needsUpdate=!0)},f.prototype.pan=function(t,e,i){console.log("`pan` has been renamed to `truck`"),this.truck(t,e,i)},f.prototype.truck=function(t,e,i){this.object.updateMatrix(),r.setFromMatrixColumn(this.object.matrix,0),a.setFromMatrixColumn(this.object.matrix,1),r.multiplyScalar(t),a.multiplyScalar(-e);var o=A.copy(r).add(a);this._targetEnd.add(o),i||this._target.copy(this._targetEnd),this._needsUpdate=!0},f.prototype.forward=function(t,e){A.setFromMatrixColumn(this.object.matrix,0),A.crossVectors(this.object.up,A),A.multiplyScalar(t),this._targetEnd.add(A),e||this._target.copy(this._targetEnd),this._needsUpdate=!0},f.prototype.moveTo=function(t,e,i,o){this._targetEnd.set(t,e,i),o||this._target.copy(this._targetEnd),this._needsUpdate=!0},f.prototype.fitTo=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this.object.isOrthographicCamera)console.warn("fitTo is not supported for OrthographicCamera");else{var o=i.paddingLeft||0,r=i.paddingRight||0,a=i.paddingBottom||0,s=i.paddingTop||0,n=t.isBox3?t.clone():(new E.Box3).setFromObject(t),h=n.getSize(A),c=h.x+o+r,l=h.y+s+a,d=h.z,p=this.getDistanceToFit(c,l,d);this.dollyTo(p,e);var u=n.getCenter(A),m=u.x-(.5*o-.5*r),g=u.y+(.5*s-.5*a),_=u.z;this.moveTo(m,g,_,e),this._sanitizeSphericals(),this.rotateTo(0,90*E.Math.DEG2RAD,e)}},f.prototype.setLookAt=function(t,e,i,o,r,a,s){var n=A.set(t,e,i),h=x.set(o,r,a);this._targetEnd.copy(h),this._sphericalEnd.setFromVector3(n.sub(h)),this._sanitizeSphericals(),s||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},f.prototype.lerpLookAt=function(t,e,i,o,r,a,s,n,h,c,l,d,p,u){var m=A.set(t,e,i),g=x.set(o,r,a);w.setFromVector3(m.sub(g));var _=A.set(c,l,d);this._targetEnd.copy(g).lerp(_,p);var v=x.set(s,n,h);M.setFromVector3(v.sub(_));var y=M.theta-w.theta,f=M.phi-w.phi,E=M.radius-w.radius;this._sphericalEnd.set(w.radius+E*p,w.phi+f*p,w.theta+y*p),this._sanitizeSphericals(),u||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},f.prototype.setPosition=function(t,e,i,o){this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,o)},f.prototype.setTarget=function(t,e,i,o){var r=this.getPosition(A);this.setLookAt(r.x,r.y,r.z,t,e,i,o)},f.prototype.getDistanceToFit=function(t,e,i){var o=this.object,r=t/e,a=o.fov*E.Math.DEG2RAD,s=o.aspect;return.5*(r<s?e:t/s)/Math.tan(.5*a)+.5*i},f.prototype.getTarget=function(t){return(t&&t.isVector3?t:new E.Vector3).copy(this._targetEnd)},f.prototype.getPosition=function(t){return(t&&t.isVector3?t:new E.Vector3).setFromSpherical(this._sphericalEnd).add(this._targetEnd)},f.prototype.reset=function(t){this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t)},f.prototype.saveState=function(){this._target0.copy(this._target),this._position0.copy(this.object.position),this._zoom0=this.object.zoom},f.prototype.update=function(t){var e=this._state===D?this.dampingFactor:this.draggingDampingFactor,i=1-Math.exp(-e*t/.016),o=this._sphericalEnd.theta-this._spherical.theta,r=this._sphericalEnd.phi-this._spherical.phi,a=this._sphericalEnd.radius-this._spherical.radius,s=A.subVectors(this._targetEnd,this._target);if(Math.abs(o)>g||Math.abs(r)>g||Math.abs(a)>g||Math.abs(s.x)>g||Math.abs(s.y)>g||Math.abs(s.z)>g?(this._spherical.set(this._spherical.radius+a*i,this._spherical.phi+r*i,this._spherical.theta+o*i),this._target.add(s.multiplyScalar(i)),this._needsUpdate=!0):(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd)),0!==this._dollyControlAmount){if(this.object.isPerspectiveCamera){var n=A.copy(A.setFromSpherical(this._sphericalEnd)).normalize().negate(),h=x.copy(n).cross(m.set(0,1,0)).normalize(),c=m.crossVectors(h,n),l=this._sphericalEnd.radius*Math.tan(this.object.fov*E.Math.DEG2RAD*.5),d=(this._sphericalEnd.radius-this._dollyControlAmount-this._sphericalEnd.radius)/this._sphericalEnd.radius,p=A.copy(this._targetEnd).add(h.multiplyScalar(this._dollyControlCoord.x*l*this.object.aspect)).add(c.multiplyScalar(this._dollyControlCoord.y*l));this._targetEnd.lerp(p,d),this._target.copy(this._targetEnd)}this._dollyControlAmount=0}this._spherical.makeSafe(),this.object.position.setFromSpherical(this._spherical).add(this._target),this.object.lookAt(this._target);var u=this._needsUpdate;return this._needsUpdate=!1,u&&this.dispatchEvent({type:"update"}),u},f.prototype.toJSON=function(){return JSON.stringify({enabled:this.enabled,minDistance:this.minDistance,maxDistance:e(this.maxDistance),minPolarAngle:this.minPolarAngle,maxPolarAngle:e(this.maxPolarAngle),minAzimuthAngle:e(this.minAzimuthAngle),maxAzimuthAngle:e(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:this.object.position.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray()})},f.prototype.fromJSON=function(t,e){var i=JSON.parse(t),o=(new E.Vector3).fromArray(i.position);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=s(i.maxDistance),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=s(i.maxPolarAngle),this.minAzimuthAngle=s(i.minAzimuthAngle),this.maxAzimuthAngle=s(i.maxAzimuthAngle),this.dampingFactor=i.dampingFactor,this.draggingDampingFactor=i.draggingDampingFactor,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._targetEnd.fromArray(i.target),this._sphericalEnd.setFromVector3(o.sub(this._target0)),e||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},f.prototype.dispose=function(){this._removeAllEventListeners()},f.prototype._sanitizeSphericals=function(){this._sphericalEnd.theta=this._sphericalEnd.theta%(2*Math.PI),this._spherical.theta+=2*Math.PI*Math.round((this._sphericalEnd.theta-this._spherical.theta)/(2*Math.PI))},f}(t)});
